"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7599],{7599:(A,y,f)=>{f.r(y),f.d(y,{ProfilePage:()=>F});var u=f(467),p=f(4341),d=f(4742),g=f(5083),h=function(c){return c.Prompt="PROMPT",c.Camera="CAMERA",c.Photos="PHOTOS",c}(h||{}),v=function(c){return c.Rear="REAR",c.Front="FRONT",c}(v||{}),b=function(c){return c.Uri="uri",c.Base64="base64",c.DataUrl="dataUrl",c}(b||{});class P extends g.E_{getPhoto(i){var s=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,n){if(i.webUseInput||i.source===h.Photos)s.fileInputExperience(i,t,n);else if(i.source===h.Prompt){let o=document.querySelector("pwa-action-sheet");o||(o=document.createElement("pwa-action-sheet"),document.body.appendChild(o)),o.header=i.promptLabelHeader||"Photo",o.cancelable=!1,o.options=[{title:i.promptLabelPhoto||"From Photos"},{title:i.promptLabelPicture||"Take Picture"}],o.addEventListener("onSelection",function(){var l=(0,u.A)(function*(a){0===a.detail?s.fileInputExperience(i,t,n):s.cameraExperience(i,t,n)});return function(a){return l.apply(this,arguments)}}())}else s.cameraExperience(i,t,n)});return function(t,n){return e.apply(this,arguments)}}())})()}pickImages(i){var s=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,n){s.multipleFileInputExperience(t,n)});return function(t,n){return e.apply(this,arguments)}}())})()}cameraExperience(i,s,e){var t=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=i.direction===v.Front?"user":"environment",document.body.appendChild(n);try{yield n.componentOnReady(),n.addEventListener("onPhoto",function(){var o=(0,u.A)(function*(l){const a=l.detail;null===a?e(new g.I9("User cancelled photos app")):a instanceof Error?e(a):s(yield t._getCameraPhoto(a,i)),n.dismiss(),document.body.removeChild(n)});return function(l){return o.apply(this,arguments)}}()),n.present()}catch{t.fileInputExperience(i,s,e)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),t.fileInputExperience(i,s,e)})()}fileInputExperience(i,s,e){let t=document.querySelector("#_capacitor-camera-input");const n=()=>{var o;null===(o=t.parentNode)||void 0===o||o.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",o=>{const l=t.files[0];let a="jpeg";if("image/png"===l.type?a="png":"image/gif"===l.type&&(a="gif"),"dataUrl"===i.resultType||"base64"===i.resultType){const m=new FileReader;m.addEventListener("load",()=>{if("dataUrl"===i.resultType)s({dataUrl:m.result,format:a});else if("base64"===i.resultType){const U=m.result.split(",")[1];s({base64String:U,format:a})}n()}),m.readAsDataURL(l)}else s({webPath:URL.createObjectURL(l),format:a}),n()}),t.addEventListener("cancel",o=>{e(new g.I9("User cancelled photos app")),n()})),t.accept="image/*",t.capture=!0,i.source===h.Photos||i.source===h.Prompt?t.removeAttribute("capture"):i.direction===v.Front?t.capture="user":i.direction===v.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(i,s){let e=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var n;null===(n=e.parentNode)||void 0===n||n.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input-multiple",e.type="file",e.hidden=!0,e.multiple=!0,document.body.appendChild(e),e.addEventListener("change",n=>{const o=[];for(let l=0;l<e.files.length;l++){const a=e.files[l];let m="jpeg";"image/png"===a.type?m="png":"image/gif"===a.type&&(m="gif"),o.push({webPath:URL.createObjectURL(a),format:m})}i({photos:o}),t()}),e.addEventListener("cancel",n=>{s(new g.I9("User cancelled photos app")),t()})),e.accept="image/*",e.click()}_getCameraPhoto(i,s){return new Promise((e,t)=>{const n=new FileReader,o=i.type.split("/")[1];"uri"===s.resultType?e({webPath:URL.createObjectURL(i),format:o,saved:!1}):(n.readAsDataURL(i),n.onloadend=()=>{const l=n.result;e("dataUrl"===s.resultType?{dataUrl:l,format:o,saved:!1}:{base64String:l.split(",")[1],format:o,saved:!1})},n.onerror=l=>{t(l)})})}checkPermissions(){var i=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw i.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw i.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var i=this;return(0,u.A)(function*(){throw i.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var i=this;return(0,u.A)(function*(){throw i.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var i=this;return(0,u.A)(function*(){throw i.unavailable("Not implemented on web.")})()}}new P;const E=(0,g.F3)("Camera",{web:()=>new P});var r=f(4438),C=f(5844),w=f(1626),I=f(8880),k=f(6766);let F=(()=>{var c;class i{constructor(e,t,n,o,l,a,m){this.authService=e,this.http=t,this.loadingController=n,this.alertController=o,this.toastController=l,this.navCtrl=a,this.router=m,this.profileImage=null,this.server="https://b6d7-154-72-150-173.ngrok-free.app"}ngOnInit(){this.initForm(),this.loadUserProfile()}initForm(){this.profileForm=new p.gE({username:new p.MJ({value:"",disabled:!0},p.k0.required),email:new p.MJ("",[p.k0.required,p.k0.email]),role:new p.MJ({value:"",disabled:!0},p.k0.required)})}loadUserProfile(){var e=this;return(0,u.A)(function*(){const t=yield e.loadingController.create({message:"Chargement du profil..."});yield t.present();try{const n=localStorage.getItem("authToken"),o=localStorage.getItem("userId");if(!n||!o)throw new Error("No auth token or user ID found");e.authService.getUserProfile().subscribe({next:(l=(0,u.A)(function*(a){var m;console.log("Profil utilisateur r\xe9cup\xe9r\xe9:",a),e.user=a.data,e.profileForm.patchValue({username:e.user.username,email:e.user.email,role:e.user.role}),e.profileImage=null!==(m=e.user.profileImage)&&void 0!==m?m:"/assets/imgs/avatar.jpg",yield t.dismiss()}),function(m){return l.apply(this,arguments)}),error:function(){var l=(0,u.A)(function*(a){yield t.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de charger le profil utilisateur.",buttons:["OK"]})).present()});return function(m){return l.apply(this,arguments)}}()})}catch(n){console.error("Erreur lors du chargement du profil:",n),yield t.dismiss()}var l})()}decodeToken(e){try{return JSON.parse(atob(e.split(".")[1]))}catch{return null}}updateProfile(){var e=this;return(0,u.A)(function*(){if(e.profileForm.invalid)return void e.profileForm.markAllAsTouched();const t=yield e.loadingController.create({message:"Mise \xe0 jour du profil..."});var n;yield t.present(),e.authService.updateUserProfile(e.profileForm.value).subscribe({next:(n=(0,u.A)(function*(){yield t.dismiss(),(yield e.toastController.create({message:"Profil mis \xe0 jour avec succ\xe8s",duration:2e3,position:"bottom"})).present()}),function(){return n.apply(this,arguments)}),error:function(){var n=(0,u.A)(function*(){yield t.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Erreur lors de la mise \xe0 jour du profil.",buttons:["OK"]})).present()});return function(){return n.apply(this,arguments)}}()})})()}changeProfileImage(){var e=this;return(0,u.A)(function*(){try{var t;const n=yield E.getPhoto({quality:90,allowEditing:!1,resultType:b.DataUrl,source:h.Photos});e.profileImage=null!==(t=n.dataUrl)&&void 0!==t?t:"";const o=yield e.loadingController.create({message:"Mise \xe0 jour de la photo de profil..."});yield o.present(),e.authService.updateProfileImage(e.profileImage).subscribe({next:(l=(0,u.A)(function*(){yield o.dismiss(),(yield e.toastController.create({message:"Photo de profil mise \xe0 jour avec succ\xe8s",duration:2e3,position:"bottom"})).present()}),function(){return l.apply(this,arguments)}),error:function(){var l=(0,u.A)(function*(){yield o.dismiss(),yield(yield e.alertController.create({header:"Erreur",message:"Impossible de mettre \xe0 jour la photo de profil.",buttons:["OK"]})).present()});return function(){return l.apply(this,arguments)}}()})}catch(n){console.log("Erreur lors du changement de la photo de profil",n)}var l})()}goBack(){this.navCtrl.back()}}return(c=i).\u0275fac=function(e){return new(e||c)(r.rXU(C.u),r.rXU(w.Qq),r.rXU(d.Xi),r.rXU(d.hG),r.rXU(d.K_),r.rXU(I.q9),r.rXU(k.Ix))},c.\u0275cmp=r.VBU({type:c,selectors:[["app-profile"]],standalone:!0,features:[r.aNF],decls:31,vars:2,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back-outline"],[1,"profile-image-container"],["alt","Profile Image",3,"src"],["expand","block",3,"click"],[3,"formGroup"],["position","floating"],["formControlName","username","readonly",""],["formControlName","email"],["formControlName","role","readonly",""]],template:function(e,t){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),r.bIt("click",function(){return t.goBack()}),r.nrm(4,"ion-icon",2),r.k0s()(),r.j41(5,"ion-title"),r.EFF(6,"Profil"),r.k0s()()(),r.j41(7,"ion-content")(8,"div",3),r.nrm(9,"img",4),r.j41(10,"ion-button",5),r.bIt("click",function(){return t.changeProfileImage()}),r.EFF(11,"Changer la photo"),r.k0s()(),r.j41(12,"form",6)(13,"ion-item")(14,"ion-label",7),r.EFF(15,"Nom d'utilisateur"),r.k0s(),r.nrm(16,"ion-input",8),r.k0s(),r.j41(17,"ion-item")(18,"ion-label",7),r.EFF(19,"Email"),r.k0s(),r.nrm(20,"ion-input",9),r.k0s(),r.j41(21,"ion-item")(22,"ion-label",7),r.EFF(23,"R\xf4le"),r.k0s(),r.nrm(24,"ion-input",10),r.k0s(),r.j41(25,"ion-button",5),r.bIt("click",function(){return t.updateProfile()}),r.EFF(26,"Mettre \xe0 jour"),r.k0s()()(),r.j41(27,"ion-footer")(28,"ion-toolbar")(29,"ion-title"),r.EFF(30,"\xa9 2024 UdM Attendance"),r.k0s()()()),2&e&&(r.R7$(9),r.Y8G("src",t.profileImage||"/assets/imgs/avatar.jpg",r.B4B),r.R7$(3),r.Y8G("formGroup",t.profileForm))},dependencies:[d.bv,d.Jm,d.QW,d.W9,d.M0,d.eU,d.iq,d.$w,d.uz,d.he,d.BC,d.ai,d.Gw,p.X1,p.qT,p.BC,p.cb,p.j4,p.JD],styles:[".profile-image-container[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.profile-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;margin-bottom:10px}ion-card[_ngcontent-%COMP%], ion-thumbnail[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}ion-footer[_ngcontent-%COMP%]{background-color:#fffc;text-align:center}ion-title[_ngcontent-%COMP%]{font-size:1rem;color:#4e0894}"]}),i})()}}]);