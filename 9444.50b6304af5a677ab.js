"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9444],{9444:(y,_,a)=>{a.r(_),a.d(_,{LoginPage:()=>x});var l=a(467),s=a(4341),o=a(4742),g=a(1587),P=a(1626),C=a(177),M=a(5083),n=a(4438),b=a(5844),O=a(8880),v=a(6766);let x=(()=>{var m;class f{constructor(e,t,r,u,d,i){this.authService=e,this.navCtrl=t,this.loadingController=r,this.alertController=u,this.toastController=d,this.router=i,this.isPwdVisible=!1,this.server="https://udmattendance.loca.lt",this.initForm()}initForm(){this.form=new s.gE({email:new s.MJ("",[s.k0.required,s.k0.email]),password:new s.MJ("",[s.k0.required,s.k0.minLength(8)])})}togglePwdVisibility(){this.isPwdVisible=!this.isPwdVisible}onSubmit(){var e=this;return(0,l.A)(function*(){if(e.form.invalid)return void e.form.markAllAsTouched();const t=yield e.loadingController.create({message:"Connexion en cours..."});yield t.present();const r=e.form.value.email,u=e.form.value.password;var d;e.authService.login(r,u).subscribe({next:(d=(0,l.A)(function*(i){console.log("R\xe9ponse du serveur:",i),yield t.dismiss(),i&&i.user&&i.user.id?(localStorage.setItem("authToken",i.access_token),localStorage.setItem("userId",i.user.id),yield e.saveCredentials({email:r,password:u}),e.router.navigate(["/home"])):(console.log("Probl\xe8me avec la r\xe9ponse utilisateur:",i),yield(yield e.alertController.create({header:"Erreur de connexion",message:"R\xe9ponse inattendue du serveur. Identifiant utilisateur non trouv\xe9.",buttons:["OK"]})).present())}),function(c){return d.apply(this,arguments)}),error:function(){var d=(0,l.A)(function*(i){yield t.dismiss(),yield(yield e.alertController.create({header:"Erreur de connexion",message:"Identifiants incorrects ou probl\xe8me de connexion.",buttons:["OK"]})).present(),console.error("Erreur de connexion:",i)});return function(c){return d.apply(this,arguments)}}()})})()}performBiometricVerification(){var e=this;return(0,l.A)(function*(){try{if(!(yield g.qG.isAvailable()).isAvailable||!(yield g.qG.verifyIdentity({reason:"Authentification biom\xe9trique",title:"Connexion",useFallback:!0,maxAttempts:2}).then(()=>!0).catch(()=>!1)))return;yield e.getCredentials()}catch(t){console.log(t)}})()}saveCredentials(e){var t=this;return(0,l.A)(function*(){try{M.Ii.isNativePlatform()?(yield g.qG.setCredentials({username:e.email,password:e.password,server:t.server}),t.showToast("Connexion r\xe9ussie et identifiants sauvegard\xe9s")):console.log("Biometric features are not supported on the web platform.")}catch(r){console.log(r)}})()}getCredentials(){var e=this;return(0,l.A)(function*(){try{const t=yield g.qG.getCredentials({server:e.server}),r=yield e.loadingController.create({message:"Connexion en cours..."});yield r.present(),e.authService.login(t.username,t.password).subscribe({next:(i=(0,l.A)(function*(c){yield r.dismiss(),localStorage.setItem("authToken",c.token),e.router.navigate(["/home"])}),function(h){return i.apply(this,arguments)}),error:function(){var i=(0,l.A)(function*(c){yield r.dismiss(),yield(yield e.alertController.create({header:"Erreur de connexion",message:"Impossible de se connecter avec les identifiants biom\xe9triques.",buttons:["OK"]})).present(),console.error("Erreur de connexion:",c)});return function(h){return i.apply(this,arguments)}}()})}catch(t){console.log(t)}var i})()}deleteCredentials(){var e=this;return(0,l.A)(function*(){try{yield g.qG.deleteCredentials({server:e.server}),e.showToast("Identifiants biom\xe9triques supprim\xe9s")}catch(t){console.log(t)}})()}showToast(e){var t=this;return(0,l.A)(function*(){(yield t.toastController.create({message:e,duration:3e3,position:"bottom"})).present()})()}}return(m=f).\u0275fac=function(e){return new(e||m)(n.rXU(b.u),n.rXU(O.q9),n.rXU(o.Xi),n.rXU(o.hG),n.rXU(o.K_),n.rXU(v.Ix))},m.\u0275cmp=n.VBU({type:m,selectors:[["app-login"]],standalone:!0,features:[n.aNF],decls:51,vars:6,consts:[[3,"fullscreen"],[1,"header-section"],[1,"app-name"],[1,"logo-container"],["alt","Logo Universit\xe9",1,"university-logo",3,"src"],[3,"formGroup"],[1,"ion-text-center","ion-margin-vertical","lock"],["name","lock-closed"],["lines","none",1,"ion-margin-horizontal","ion-margin-top"],["slot","start","fill","clear","color","medium"],["slot","icon-only","name","mail-outline"],["labelPlacement","floating","type","email","inputmode","email","formControlName","email","placeholder","Entrez votre adresse email","enterkeyhint","next"],["slot","label"],["color","danger"],["lines","none",1,"ion-margin"],["slot","start","fill","clear","color","dark"],["slot","icon-only","name","key-outline"],["labelPlacement","floating","placeholder","Entrez votre mot de passe","formControlName","password","enterkeyhint","enter",3,"type","inputmode"],["slot","end","fill","clear","color","danger",3,"click"],["slot","icon-only",3,"name"],[1,"ion-text-right","ion-margin-horizontal"],["color","light",1,"fwd"],[1,"ion-margin","submit"],["expand","block","size","large",3,"click"],[1,"ion-margin","authorize"],["size","9"],["expand","block","size","large",1,"faceid",3,"click"],[1,"ion-text-wrap"],["size","3"],["expand","block","size","large","color","light",3,"click"],["slot","icon-only","name","trash","color","danger"]],template:function(e,t){1&e&&(n.j41(0,"ion-content",0)(1,"div",1)(2,"h1",2),n.EFF(3,"UdM Attendance"),n.k0s(),n.j41(4,"div",3),n.nrm(5,"img",4),n.k0s()(),n.j41(6,"ion-card")(7,"form",5)(8,"div",6),n.nrm(9,"ion-icon",7),n.k0s(),n.j41(10,"ion-item",8)(11,"ion-button",9),n.nrm(12,"ion-icon",10),n.k0s(),n.j41(13,"ion-input",11)(14,"div",12),n.EFF(15,"Email "),n.j41(16,"ion-text",13),n.EFF(17,"*"),n.k0s()()()(),n.j41(18,"ion-item",14)(19,"ion-button",15),n.nrm(20,"ion-icon",16),n.k0s(),n.j41(21,"ion-input",17)(22,"div",12),n.EFF(23,"Mot de passe "),n.j41(24,"ion-text",13),n.EFF(25,"*"),n.k0s()()(),n.j41(26,"ion-button",18),n.bIt("click",function(){return t.togglePwdVisibility()}),n.nrm(27,"ion-icon",19),n.k0s()(),n.j41(28,"div",20)(29,"ion-text",21),n.EFF(30,"Mot de passe oubli\xe9 ?"),n.k0s()(),n.j41(31,"div",22)(32,"ion-button",23),n.bIt("click",function(){return t.onSubmit()}),n.j41(33,"ion-text")(34,"strong"),n.EFF(35,"Se connecter"),n.k0s()()()()(),n.j41(36,"ion-row",24)(37,"ion-col",25)(38,"ion-button",26),n.bIt("click",function(){return t.performBiometricVerification()}),n.j41(39,"ion-text",27)(40,"strong"),n.EFF(41,"S'authentifier avec la biom\xe9trie"),n.k0s(),n.j41(42,"span"),n.EFF(43,"(Face ID / Empreinte digitale)"),n.k0s()()()(),n.j41(44,"ion-col",28)(45,"ion-button",29),n.bIt("click",function(){return t.deleteCredentials()}),n.nrm(46,"ion-icon",30),n.k0s()()()()(),n.j41(47,"ion-footer")(48,"ion-toolbar")(49,"ion-title"),n.EFF(50,"\xa9 2024 UdM Attendance"),n.k0s()()()),2&e&&(n.Y8G("fullscreen",!0),n.R7$(5),n.Y8G("src","/assets/imgs/logo-universite.png",n.B4B),n.R7$(2),n.Y8G("formGroup",t.form),n.R7$(14),n.Y8G("type",t.isPwdVisible?"text":"password")("inputmode",t.isPwdVisible?"text":"password"),n.R7$(6),n.Y8G("name",t.isPwdVisible?"eye-off-outline":"eye-outline"))},dependencies:[P.q1,o.bv,o.Jm,o.b_,o.hU,o.W9,o.M0,o.iq,o.$w,o.uz,o.ln,o.IO,o.BC,o.ai,o.Gw,C.MD,s.X1,s.qT,s.BC,s.cb,s.j4,s.JD],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: #f0f2f5;display:flex;flex-direction:column;justify-content:center;align-items:center}.header-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.header-section[_ngcontent-%COMP%]   .app-name[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#4e0894;margin-bottom:10px}.header-section[_ngcontent-%COMP%]   .logo-container[_ngcontent-%COMP%]   img.university-logo[_ngcontent-%COMP%]{width:150px;height:auto;object-fit:contain}ion-card[_ngcontent-%COMP%]{width:90%;max-width:400px;padding:20px;border-radius:15px;box-shadow:0 4px 12px #0000001a;background:#fff}.lock[_ngcontent-%COMP%]{font-size:3rem;color:#4e0894}ion-item[_ngcontent-%COMP%]{display:flex;align-items:center}ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;margin-right:10px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{flex:1;--padding-start: 0;--padding-end: 0}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700}.fwd[_ngcontent-%COMP%]{font-size:.9rem;cursor:pointer;text-decoration:underline}.submit[_ngcontent-%COMP%]{margin-top:20px}.submit[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: linear-gradient(90deg, #4e0894, #b006d0);--border-radius: 20px;font-size:1.1rem;font-weight:700}.authorize[_ngcontent-%COMP%]{margin-top:20px}.authorize[_ngcontent-%COMP%]   ion-button.faceid[_ngcontent-%COMP%]{background:linear-gradient(90deg,#6a11cb,#2575fc);border-radius:20px;color:#fff}.authorize[_ngcontent-%COMP%]   ion-button.faceid[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.authorize[_ngcontent-%COMP%]   ion-button.faceid[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem}.authorize[_ngcontent-%COMP%]   ion-button.faceid[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem;opacity:.8}.authorize[_ngcontent-%COMP%]   ion-button[color=light][_ngcontent-%COMP%]{background:#f0f2f5;border-radius:20px}.authorize[_ngcontent-%COMP%]   ion-button[color=light][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:#ff3b30}ion-toast[_ngcontent-%COMP%]{--background: rgba(0, 0, 0, .8);--color: #ffffff;border-radius:12px;font-size:.9rem;text-align:center}@media (max-width: 600px){ion-card[_ngcontent-%COMP%]{width:95%;padding:15px}.app-name[_ngcontent-%COMP%]{font-size:1.8rem}.logo-container[_ngcontent-%COMP%]   img.university-logo[_ngcontent-%COMP%]{width:120px}.lock[_ngcontent-%COMP%]{font-size:2.5rem}ion-button.faceid[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:.95rem}ion-button.faceid[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.75rem}}ion-footer[_ngcontent-%COMP%]{background-color:#fffc;text-align:center}ion-title[_ngcontent-%COMP%]{font-size:1rem;color:#4e0894}']}),f})()}}]);