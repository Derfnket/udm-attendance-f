"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4250],{1869:(O,v,o)=>{o.r(v),o.d(v,{ArrivalPage:()=>y});var u=o(467),e=o(4742),g=o(1626),f=o(177),t=o(4438),p=o(5312);let h=(()=>{var r;class c{constructor(n){this.http=n,this.apiUrl=`${p.c.apiUrl}/attendance`}startScan(){return this.http.get(`${this.apiUrl}/start-scan`)}validateArrival(n){return this.http.post(`${this.apiUrl}/arrival`,{qrCodeData:n})}}return(r=c).\u0275fac=function(n){return new(n||r)(t.KVO(g.Qq))},r.\u0275prov=t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),c})();var m=o(5844),C=o(1186),b=o(3172);function P(r,c){if(1&r&&(t.j41(0,"ion-item")(1,"ion-label",5),t.EFF(2),t.k0s()()),2&r){const s=t.XpG();t.R7$(2),t.SpI("R\xe9sultat scann\xe9 : ",s.scannedResult,"")}}let y=(()=>{var r;class c{constructor(n,i,a,l,d,S,A){this.arrivalService=n,this.authService=i,this.qrScannerService=a,this.geolocationService=l,this.alertController=d,this.loadingController=S,this.toastController=A,this.scannedResult=null}ngOnInit(){}startScan(){var n=this;return(0,u.A)(function*(){const i=yield n.loadingController.create({message:"Veuillez patienter..."});yield i.present();try{const a=yield n.qrScannerService.startScan();if(!a)throw new Error("Le QR code scann\xe9 est vide.");n.scannedResult=a;const l=yield n.authService.verifyBiometric("Authentification biom\xe9trique pour l'arriv\xe9e");if(!l)throw new Error("\xc9chec de la v\xe9rification biom\xe9trique.");const d=yield n.geolocationService.getCurrentLocation();if(!d)throw new Error("Impossible d'obtenir la localisation GPS.");yield n.authService.recordArrival(a,d.latitude,d.longitude,l).toPromise(),yield n.presentToast("Arriv\xe9e enregistr\xe9e avec succ\xe8s.")}catch(a){yield n.presentAlert("Erreur",a.message||"Une erreur est survenue.")}finally{yield i.dismiss()}})()}presentAlert(n,i){var a=this;return(0,u.A)(function*(){yield(yield a.alertController.create({header:n,message:i,buttons:["OK"]})).present()})()}presentToast(n){var i=this;return(0,u.A)(function*(){(yield i.toastController.create({message:n,duration:3e3,position:"bottom"})).present()})()}ngOnDestroy(){this.qrScannerService.stopScan()}}return(r=c).\u0275fac=function(n){return new(n||r)(t.rXU(h),t.rXU(m.u),t.rXU(C.V),t.rXU(b.O),t.rXU(e.hG),t.rXU(e.Xi),t.rXU(e.K_))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-arrival"]],standalone:!0,features:[t.aNF],decls:18,vars:1,consts:[["slot","start"],["defaultHref","/home"],[1,"ion-text-center"],["expand","block",3,"click"],[4,"ngIf"],[1,"ion-text-wrap"]],template:function(n,i){1&n&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Enregistrer Arriv\xe9e"),t.k0s(),t.j41(4,"ion-buttons",0),t.nrm(5,"ion-back-button",1),t.k0s()()(),t.j41(6,"ion-content")(7,"ion-card",2)(8,"ion-card-content")(9,"p"),t.EFF(10,"Scannez le QR code pour enregistrer votre arriv\xe9e."),t.k0s(),t.j41(11,"ion-button",3),t.bIt("click",function(){return i.startScan()}),t.EFF(12,"Scanner QR Code"),t.k0s()()(),t.DNE(13,P,3,1,"ion-item",4),t.k0s(),t.j41(14,"ion-footer")(15,"ion-toolbar")(16,"ion-title"),t.EFF(17,"\xa9 2024 UdM Attendance"),t.k0s()()()),2&n&&(t.R7$(13),t.Y8G("ngIf",i.scannedResult))},dependencies:[g.q1,e.bv,e.Jm,e.QW,e.b_,e.I9,e.W9,e.M0,e.eU,e.uz,e.he,e.BC,e.ai,e.el,f.MD,f.bT],styles:["ion-content[_ngcontent-%COMP%]{--background: #f7f5f8}ion-content[_ngcontent-%COMP%]   .ion-text-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{box-shadow:none;border-radius:20px;transform:translateY(10%);background-color:#ffffff4d;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{font-size:1rem;color:#000;padding:20px;text-align:center}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: linear-gradient(to right, #B006D0, #4E0894);margin-top:20px}ion-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .6);margin-top:20px;border-radius:10px;padding:10px}ion-card[_ngcontent-%COMP%], ion-thumbnail[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}ion-footer[_ngcontent-%COMP%]{background-color:#fffc;text-align:center}ion-title[_ngcontent-%COMP%]{font-size:1rem;color:#4e0894}"]}),c})()}}]);